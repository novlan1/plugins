:::info 作者

novlan1

:::

# 研发平台出海项目配置

## 1. 开始

研发平台上，出海项目和国内项目发布方式一样，部署方式基本一样，核心是更改BCS的模板集。

这里介绍研发平台关于出海项目的配置项、及注意点。

## 2. CLB 管理

首先要配置新域名，可[参考这里](https://iwiki.aow.com/p/1564466720)。简单来说，就是找运维要新域名的 clb 配置，填到研发平台的表单里，[在这里](https://mobile.aow.com/rd-platform-web/#/management/clb)。

<img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_82sCnrzMj68bab7Q.png" width="500">


## 3. COS 及 CDN 管理

[在这里](https://mobile.aow.com/rd-platform-web/#/management/cdn)配置 COS 及 CDN。

<img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2024/1/own_mike_a597d483e84c6fcd1e.png" width="500">

## 4. 域名和集群管理

然后填写域名和集群相关的配置，示例如下：

<img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_FrsJSPG4KhnRR2hj.png" width="500">

1. 3种域名，测试、预发布、正式
2. 集群ID，找运维要
3. `nodePort`，默认为`0`，自动暴露
4. 是否为海外集群，出海项目选是
5. 集群Code，集群项目英文名，比如，海外赛宝为 `hoksaibao`
6. 模板集名称，查看方式：蓝鲸容器管理平台 => 部署管理 => 模板集 => 模板集列表，找对应的前端模版集
7. 模板集版本，查找方式同模板集名称

<img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2024/1/own_mike_3f92309e4f9a9aa3cc.png" width="500">

8. 分发镜像地址前缀，找运维要，用于蓝盾流水线推送镜像
9. 分发镜像凭证名称，找运维要，推送镜像的账号密钥，然后存入蓝盾凭证管理平台，其名称即为这里填入的名称

<img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2024/1/own_mike_534caf77a9cf8d9bb8.png" width="500">

10. 集群引入镜像前缀，用于生成 `deployment.yaml` 中的镜像地址。一般与分发镜像地址前缀相同，也可以不同。
11. `Ingress` 中是否使用 `service` 名称，该选项控制 `Ingress.yaml` 的配置形式，选是时，使用的形式是 `backend.service.name`，选否时，使用的形式是 `backend.serviceName`

```ts
if (useIngressService) {
  // 添加nginx默认路由
  paths.push({
    backend: {
      service: {
        name: `service-nginx-${domain.replaceAll('\\.', '-')}`,
        port: {
          number: 80,
        },
      },
    },
    path: '/',
    pathType: 'Prefix',
  });
} else {
  paths.push({
    path: '/',
    backend: {
      serviceName: `service-nginx-${domain.replaceAll('\\.', '-')}`,
      servicePort: 80,
    },
  });
}
```

12. `Ingress Api Version`，顾名思义，即为 `Ingress` 的版本，对应其 `apiVersion` 字段。
13. 配置对应的 COS

## 5. 更新模板集

"BCS-YAML模板集" 这个蓝盾插件用于更新 BCS 的模板集，需要注意下权限：

- 流水线更新人与流水线启动者是否相同
- 流水线启动者是否有BCS该项目的运维权限

研发平台额外提供了“远程调用”的方式，可传入远程触发的流水线id，和触发人。

<img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_rypGTBShyhdRzsc6.png" width="500">

这里的流水线 id 可以从蓝盾流水线这里查看，触发人填有 BCS 运维权限的人。

<img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2024/1/own_mike_b10a8e595925be63da.png" width="700">
