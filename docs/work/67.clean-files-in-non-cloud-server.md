:::info 作者

novlan1

2025.9.4

:::

# 非上云机器清理文件

之前非上云的构建流程有问题，`tar` 打包是在 `build` 过程中，在之后对静态文件进行上传CDN以及删除本地文件后，没有再次打包，导致真正发布的还是以前的 `tar` 文件，进而导致机器上静态文件巨多，磁盘爆满。

## 1. 优化

解决办法，在上传CDN、删除本地文件后，重新进行打包。

```sh
tar -cvf light-dist.tar ./*
```

## 2. 效果

对比一下，之前发布一次，机器增加15M文件。同时，发布重复分支，文件一样增加。

<img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_GfRBwzd6RMijbz6R.png" width="600" />

现在发布一次，机器只增加16K文件。并且，发布重复分支，文件大小基本不变（只有 `index.html`）。

<img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_4TfaZkYJwtKzEyKE.png" width="600" />

删除之前的文件：

```sh
cd /data/website/userweb/htdocs/tip/ingame-page/feature

# 查看下当前文件大小
du -sh ./
su -h ./

# 先打印
find . -maxdepth 1 ! -name '.' -print

# 排除几个分支后删除
find . -maxdepth 1 ! -name '.' ! -name 'goods-money-wx' ! -name 'goods-compliance-phone-unbind' ! -name 'goods-use-reward' ! -name 'back-to-act' ! -name 'gp-act-page' -exec rm -rf {} +
```

看看机器上磁盘大小：

```sh
# 发布目录
du -h --max-depth=1 /data/website/ | sort -h

df -TH
```

之前：

<img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_dX3G4KcyPZaCnE4b.png" width="600" />

<br />

<img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_pdXMPEb6RRapbc37.png" width="600" />

现在：

<img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_zwkWswTGtWRB3DW2.png" width="600" />

<br />

<img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_z68dKa6cE5TsecKD.png" width="600" />

## 3. 其他

在这里申请 bf 权限登录

https://bf.aow.com/#/permissionApply/permissionApply

<img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_yDs3F8pBPTFn6eAB.png" width="500" />

权限通过后，用 `WETERM` 上登录 `mnet2`，登录之后输入 `bf list`，如果只有一个权限的话，直接就会进入目标机器。

输入 `ifconfig` 可以验证 `ip` 是否符合预期。
