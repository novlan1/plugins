:::info 作者

novlan1

2025.9.5

:::

# ingame-page 上云

`igame.qq.com` 旧项目逐步上云，包括 `ingame-page` 的几个旧项目。实现方式及影响参考 [电子流项目上云](./61.match-apply-to-cloud)

## 1. 上云策略

`ingame-page` 子工程众多（49），上云迁移策略：

1. 先迁 `igame-xxGame`, `ingame-xxGame` 明确要用的、持续维护的
2. 已知废弃的不迁
3. 很久没更新的不迁，防止子仓库、`pmd` 等更新但业务没更新，进而导致现网问题

监控及动态迁移：

- 对未上云项目进行发布监控，哪个项目、子工程有使用，迁哪个

## 2. 兜底逻辑

部分项目用户量较大，且在不同的环境中使用，采取了以下兜底策略。

1. 先使用动态加载脚本的方式，并加了 `?t=xx` 参数，防止被缓存
2. 重定向脚本中增加了黑名单排除逻辑，允许部分项目不重定向

由于不被缓存，所以性能可能略有影响，等稳定后，再切换成有缓存的形式。

另外，`ingame-hlddz` 登录态之前就存在问题，抓包发现登录态 `query` 信息是动态注入的，请求后台接口时如果 `url` 还没注上 `query` 信息，就会跳登录页。这个项目采用的 `nginx` 重定向，如果是业务脚本，就很难把控重定向的时机，很有可能没注入 `query` 就跳走了。

## 3. 兼容性

与其他项目不同的是，`ingame-page` 需要兼容多种不同的跳转方式。

模式 `ingame-pvp/#/goods/list?a=1&b=1`，这种是最正常的，通过 `location.hash` 即可同时获得 `hash` 和 `query` 参数。

```
https://igame.qq.com/tip/ingame-page/ingame-pvp/#/index?algorithm=itop&openid=owanlsjC-H3lfoyWvGPI02GCxyIw&openid=owanlsjC-H3lfoyWvGPI02GCxyIw&partition=3086&partition=3086&platid=1&platid=1&areaid=3&areaid=3&area=3&area=3&roleid=1381446200&roleid=1381446200&version=5.38.104.6483&gameid=10201&encode=2&itopencodeparam=60B8C4F518935FC2570652BD5E915EF7AA76663206C3D026FCD561C8BE1ABF9BACE2498A2259168CBA8E70242112255CF8F3BA95E8F154D8BC288AF3056FAFCDF74C080DCBB5F8E960EA9D086F187844A84287736994249FA1FF177204A7516904777064C7208E6B8BFC98232D663B3F403EA9D5E02881799D0E7AB3FE73514CB65985AC8E860C3F91BD180A3F5D63D0E928B9412CF5654B610A7E14DBB188075D7DD5DD9C5A29230058C8540410CDCB24252EC33DE86EC30165B9B711FFEFB8263F6119190A037FA7B85AF7A22840DEBE008AB830446A4110A2E41C59C56BE6&sig=dcc13807b3a27f0392950af145953c81&uid=1381446200&uid=1381446200&seq=10201-f277ba09-825d-447b-95c4-425aa4fdd0f7-1757060908-47887&ts=1757060908&os=1&channelid=1&pf=desktop_m_wx-10001-android-10003392-wx-wx95a3a4d7c627e07d-owanlsjC-H3lfoyWvGPI02GCxyIw&pf=desktop_m_wx-10001-android-10003392-wx-wx95a3a4d7c627e07d-owanlsjC-H3lfoyWvGPI02GCxyIw&token=95_z6OtwpzBZge-AnRSim1uo0N-8fTsTEekdt569warxoeqIitMQlv6HeZJDE2_59zaFZY6MTQ7e8oQ6cfESUFVuwZ4WiJXcgSx_0tQL_xnDh8&token=95_z6OtwpzBZge-AnRSim1uo0N-8fTsTEekdt569warxoeqIitMQlv6HeZJDE2_59zaFZY6MTQ7e8oQ6cfESUFVuwZ4WiJXcgSx_0tQL_xnDh8&tga_version=10190850012&tga_version=10190850012&gameid_v5=10201&gameid_v5=0&login_type=msdkv5&pagesource=box&nickname=6JuH55qud2Vp&notch=42
```

模式 `ingame-pvp/index.html?a=1&b=1#/goods/list`

```
https://igame.qq.com/tip/ingame-page/ingame-pvp/index.html?acc_type=qq&actid=a20220302regiftBox&ad_tag=mailmanghe&algorithm=itop&appid=1104466820&area=1&channelid=2&encode=2&gameid=10201&itopencodeparam=5B8385D20EE188FFC25F1D246C94E69EA9826EE01A697C626CBA5584657638D9C61DCF3D31E1374B5B005110980A8D7A7DAF9F5F8AB4CF639FB21CBAA387730D90430ACF8AF17F29F1360661FF2CA3822D51B0794CEE5C8EFB774C036B2A6AC1730315450EDD52DD55D4825AF5EA43A88D44DA16C7B1EA1A262D065831657530B35BC9A394DDF4D15B9E545B2D01BC726738BFDA692BA2583DF21D28366FE7CEBC5053D49E4D1852DF8929F27867E5D32C91524C76B3D8CBAEF0D6A3541ACDCC&login_type=msdkv5&newRoleID=1113_51B00239AD62B0665078D753F37A3CF7&nickname=%EA%A7%81%20%E5%8D%90%E4%B9%8B%E7%B1%BB%E5%8D%8D%EA%A7%82&onlygood=1&openid=51B00239AD62B0665078D753F37A3CF7&orderid=6545C44872A928B5231584AC522EE3A6&os=1&partition=1113&physicalID=1&platid=1&q36=c052ad61b1d08581fc9a7b83100011a15701&roleid=1925383891&seq=10201-f2458304-978d-4390-a246-1c8cd879c5ad-1757060915-42488&sig=45a99eec907df68d5c34163fc52e3a3f&ts=1757060915&version=5.38.104.6483&wzrsOldFriend=1#/goods/list
```

模式 `ingame-pvp/index.html?=&a=1&b=1#/goods/list`，`query` 最前面加了非法字符 `=&`。

```
https://igame.qq.com/tip/ingame-page/ingame-pvp/index.html?=&acc_type=qq&actid=a20220302regiftBox&ad_tag=mailmanghe&algorithm=itop&appid=1104466820&area=1&channelid=2&encode=2&gameid=10201&itopencodeparam=5B8385D20EE188FFC25F1D246C94E69EA9826EE01A697C626CBA5584657638D9C61DCF3D31E1374B5B005110980A8D7A7DAF9F5F8AB4CF639FB21CBAA387730D90430ACF8AF17F29F1360661FF2CA3822D51B0794CEE5C8EFB774C036B2A6AC1730315450EDD52DD55D4825AF5EA43A88D44DA16C7B1EA1A262D065831657530B35BC9A394DDF4D15B9E545B2D01BC726738BFDA692BA2583DF21D28366FE7CEBC5053D49E4D1852DF8929F27867E5D32C91524C76B3D8CBAEF0D6A3541ACDCC&login_type=msdkv5&newRoleID=1113_51B00239AD62B0665078D753F37A3CF7&nickname=%EA%A7%81%20%E5%8D%90%E4%B9%8B%E7%B1%BB%E5%8D%8D%EA%A7%82&onlygood=1&openid=51B00239AD62B0665078D753F37A3CF7&orderid=6545C44872A928B5231584AC522EE3A6&os=1&partition=1113&physicalID=1&platid=1&q36=c052ad61b1d08581fc9a7b83100011a15701&roleid=1925383891&seq=10201-f2458304-978d-4390-a246-1c8cd879c5ad-1757060915-42488&sig=45a99eec907df68d5c34163fc52e3a3f&ts=1757060915&version=5.38.104.6483&wzrsOldFriend=1#/goods/list
```

模式 `ingame-pvp/?a=1&b=1#/goods/list`

```
https://igame.qq.com/tip/ingame-page/ingame-x5m/?access_token=5D60BF433EDD9F856998C8C4B111CB90&appid=1105483033&areaid=2&partition=11&platid=1&openid=3D4D6C2CEB075D4845108618B76E299D&roleid=3182919097071285504&algorithm=itop&encode=2&channelid=2&nickname=%E6%9D%A8&gameid=16446&os=1&ts=1757062211&version=5.36.003&seq=16446-19945984-f715-4743-ae8c-3c91f091e5da-1757062211-528&sig=a973ef336e4297560336eceb10f53945&itopencodeparam=B19D00BEF4F589B8FA19E17FD157EC8A07FC4A3785041C48EB8DA5FF79F1F5DDF5FCE0A9A6E6394FF75D0043EAA0A28DBC86D1F07811159038702CE0B2FE2617F3043F4B1709D0CED328D83792767A6F14ACB9DED6D47BD319446604CBAE2E27CA30A1681147361E21AC9B62C2B845EC04BF7B9A9C4E4684F6718074708208BD927C0E03BA9F1EFACDCDFB0F884D1EDBC5D063CE7AF93192DC8AA17EE61583C6A6F26D467EFCE5F21E8ABFBD364F7E04653BC61901FA0B8E#/index
```

## 4. 链接对比

标记 ✅ 表示该项目已经发布重定向了。

|<p style="width:120px">子工程</p>|<p style="width:500px">旧链接</p>|<p style="width:500px">新链接</p>|
|---|---|---|
|✅ igame-cf|https://igame.qq.com/tip/ingame-page/igame-cf/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-cf/|
|igame-coupon-test|https://igame.qq.com/tip/ingame-page/igame-coupon-test/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-coupon-test/|
|✅ igame-dnf|https://igame.qq.com/tip/ingame-page/igame-dnf/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-dnf/|
|✅ igame-download|https://igame.qq.com/tip/ingame-page/igame-download/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-download/|
|✅ igame-game-life|https://igame.qq.com/tip/ingame-page/igame-game-life/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-game-life/|
|✅ igame-game-life-web|https://igame.qq.com/tip/ingame-page/igame-game-life-web/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-game-life-web/|
|✅ igame-gp|https://igame.qq.com/tip/ingame-page/igame-gp/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-gp/|
|igame-gp-arena |https://igame.qq.com/tip/ingame-page/igame-gp-arena/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-gp-arena/|
|✅ igame-hlddz|https://igame.qq.com/tip/ingame-page/igame-hlddz/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-hlddz/|
|igame-hlddz-brand-lottery|https://igame.qq.com/tip/ingame-page/igame-hlddz-brand-lottery/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-hlddz-brand-lottery/|
|igame-jump|https://igame.qq.com/tip/ingame-page/igame-jump/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-jump/|
|igame-laxin-download|https://igame.qq.com/tip/ingame-page/igame-laxin-download/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-laxin-download/|
|✅ igame-majiang|https://igame.qq.com/tip/ingame-page/igame-majiang/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-majiang/|
|igame-majiang-brand-lottery|https://igame.qq.com/tip/ingame-page/igame-majiang-brand-lottery/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-majiang-brand-lottery/|
|✅ igame-peng|https://igame.qq.com/tip/ingame-page/igame-peng/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-peng/|
|igame-privacy|https://igame.qq.com/tip/ingame-page/igame-privacy/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-privacy/|
|✅ igame-pvp|https://igame.qq.com/tip/ingame-page/igame-pvp/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-pvp/|
|igame-pvp-arena |https://igame.qq.com/tip/ingame-page/igame-pvp-arena/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-pvp-arena/|
|igame-pvp-brand-lottery|https://igame.qq.com/tip/ingame-page/igame-pvp-brand-lottery/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-pvp-brand-lottery/|
|igame-pvp-community|https://igame.qq.com/tip/ingame-page/igame-pvp-community/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-pvp-community/|
|igame-pvp-fission-team|https://igame.qq.com/tip/ingame-page/igame-pvp-fission-team/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-pvp-fission-team/|
|igame-pvp-fission-team-v2|https://igame.qq.com/tip/ingame-page/igame-pvp-fission-team-v2/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-pvp-fission-team-v2/|
|igame-pvp-privcard|https://igame.qq.com/tip/ingame-page/igame-pvp-privcard/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-pvp-privcard/|
|igame-pvp-rank-list|https://igame.qq.com/tip/ingame-page/igame-pvp-rank-list/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-pvp-rank-list/|
|igame-pvp-write-off|https://igame.qq.com/tip/ingame-page/igame-pvp-write-off/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-pvp-write-off/|
|igame-regift-box|https://igame.qq.com/tip/ingame-page/igame-regift-box/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-regift-box/|
|igame-share-page|https://igame.qq.com/tip/ingame-page/igame-share-page/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-share-page/|
|✅ igame-test|https://igame.qq.com/tip/ingame-page/igame-test/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-test/|
|igame-wechat-jump|https://igame.qq.com/tip/ingame-page/igame-wechat-jump/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-wechat-jump/|
|igame-wechat-related|https://igame.qq.com/tip/ingame-page/igame-wechat-related/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-wechat-related/|
|✅ igame-x5m|https://igame.qq.com/tip/ingame-page/igame-x5m/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.igame-x5m/|
|✅ ingame-dnf|https://igame.qq.com/tip/ingame-page/ingame-dnf/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.ingame-dnf/|
|✅ ingame-game-life|https://igame.qq.com/tip/ingame-page/ingame-game-life/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.ingame-game-life/|
|✅ ingame-gp|https://igame.qq.com/tip/ingame-page/ingame-gp/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.ingame-gp/|
|✅ ingame-gp-arena|https://igame.qq.com/tip/ingame-page/ingame-gp-arena/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.ingame-gp-arena/|
|ingame-gp-crystal-ball |https://igame.qq.com/tip/ingame-page/ingame-gp-crystal-ball/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.ingame-gp-crystal-ball/|
|✅ ingame-hlddz|https://igame.qq.com/tip/ingame-page/ingame-hlddz/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.ingame-hlddz/|
|✅ ingame-majiang|https://igame.qq.com/tip/ingame-page/ingame-majiang/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.ingame-majiang/|
|✅ ingame-pvp|https://igame.qq.com/tip/ingame-page/ingame-pvp/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.ingame-pvp/|
|ingame-pvp-coin-system-v2|https://igame.qq.com/tip/ingame-page/ingame-pvp-coin-system-v2/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.ingame-pvp-coin-system-v2/|
|ingame-pvp-crystal-ball|https://igame.qq.com/tip/ingame-page/ingame-pvp-crystal-ball/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.ingame-pvp-crystal-ball/|
|ingame-pvp-kpl|https://igame.qq.com/tip/ingame-page/ingame-pvp-kpl/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.ingame-pvp-kpl/|
|ingame-pvp-kpl-v2|https://igame.qq.com/tip/ingame-page/ingame-pvp-kpl-v2/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.ingame-pvp-kpl-v2/|
|ingame-pvp-kpl-vertical|https://igame.qq.com/tip/ingame-page/ingame-pvp-kpl-vertical/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.ingame-pvp-kpl-vertical/|
|ingame-pvp-member-plugin|https://igame.qq.com/tip/ingame-page/ingame-pvp-member-plugin/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.ingame-pvp-member-plugin/|
|✅ ingame-sjjq|https://igame.qq.com/tip/ingame-page/ingame-sjjq/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.ingame-sjjq/|
|✅ ingame-tlbb|https://igame.qq.com/tip/ingame-page/ingame-tlbb/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.ingame-tlbb/|
|✅ ingame-x5m|https://igame.qq.com/tip/ingame-page/ingame-x5m/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.ingame-x5m/|
|✅ ingame-zqnba|https://igame.qq.com/tip/ingame-page/ingame-zqnba/|https://h5.igame.qq.com/pmd-mobile.merchant.ingame-page.ingame-zqnba/|
