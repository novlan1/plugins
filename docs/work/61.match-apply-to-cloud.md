:::info 作者

novlan1

2025.9.1

:::

# 电子流旧项目上云

`igame.qq.com` 旧项目逐步上云，包括电子流的几个旧项目。

## 1. 迁移步骤

1. 上云项目发布
2. 旧项目重定向

## 2. 影响

好处

1. 维护一套发布流程
2. 上云后支持回滚、灰度

其他

- 对用户影响：几乎无感知，重定向，登录态、缓存均生效
- 对开发、测试、产品经理影响：基本无

## 3. 实现方式

1. 业务项目中进行 `url` 匹配并重定向，而非 `nginx` 或 `apache`，好处是简单、灵活
2. 重定向逻辑放到外链中，而非放到 `html` 中，好处是易调整
3. `url` 中 `hash` 部分同样保留

参数保留的验证链接：

1. PC打开：https://igame.qq.com/tip/igame-web/match-apply/#/apply/authentification/10037bfffe1756689489?g=999010&type=2
2. 移动端打开：https://igame.qq.com/tip/igame-web/match-apply-mobile/#/audit/company/10037bfffe1756689489?type=2

业务改动点：

1. 硬编码的改造，比如拼接的路径 `${location.origin}/tip/igame-web`

```ts
// 改成
const host = window.location.origin.indexOf('test') === -1 ? 'igame.qq.com' : 'test.igame.qq.com';

// or
const origin = window.location.origin.indexOf('test') === -1 ? 'igame.qq.com' : 'test.igame.qq.com';
```
